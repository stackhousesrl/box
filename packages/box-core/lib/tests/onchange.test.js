"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _typeof=require("@babel/runtime/helpers/typeof");var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));require("jsdom-global/register");var _react=_interopRequireWildcard(require("react"));var _reactRedux=require("react-redux");var _index=_interopRequireDefault(require("../index"));var _react2=require("@testing-library/react");var _redux=require("redux");var _testUtils=require("./test-utils");function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap;var cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{"default":obj}}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj["default"]=obj;if(cache){cache.set(obj,newObj)}return newObj}var Text=function Text(_ref){var text=_ref.text,value=_ref.value;return _react["default"].createElement("h1",null,text||value)};var Input=function Input(_ref2){var _onChange=_ref2.onChange,_ref2$value=_ref2.value,value=_ref2$value===void 0?"":_ref2$value,name=_ref2.name,childId=_ref2.childId;return _react["default"].createElement("input",{"data-testid":childId,name:name,value:value,onChange:function onChange(evt){return _onChange(evt.target.value)}})};var Container=function Container(_ref3){var children=_ref3.children;return _react["default"].createElement("div",null,children)};var CustomError=function CustomError(_ref4){var setError=_ref4.setError,childId=_ref4.childId,error=_ref4.error;(0,_react.useEffect)(function(){setError(true,"error1")},[setError]);return _react["default"].createElement("h1",{"data-testid":childId},error)};_index["default"].setComponents({Input:Input,Text:Text,Container:Container,CustomError:CustomError});describe("Test children update onChange",function(){var store;beforeEach(function(){store=(0,_redux.createStore)((0,_redux.combineReducers)({app:_testUtils.userSlice.reducer}))});it("Quando passo un valore ad un input valido, mi aspetto il render dell'elemento correttamente",(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(){var children,dispatchSpy,wrapper,inputEl;return _regenerator["default"].wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:children=[{type:"Input",id:"surname",name:"surname"}];dispatchSpy=jest.spyOn(store,"dispatch");wrapper=(0,_react2.render)(_react["default"].createElement(_reactRedux.Provider,{store:store},_react["default"].createElement("div",null,_react["default"].createElement(_index["default"],{data:children,prefix:"app"}))));_context.next=5;return wrapper.getByTestId("app.surname");case 5:inputEl=_context.sent;_react2.fireEvent.change(inputEl,{target:{value:"Hello"}});expect(dispatchSpy.mock.lastCall[0].type).toEqual("@box/app/update");expect(wrapper.baseElement.innerHTML).toEqual("<div><div><input data-testid=\"app.surname\" name=\"surname\" value=\"Hello\"></div></div>");case 9:case"end":return _context.stop();}}},_callee)})));it("Quando passo un valore ad un input valido complesso e un valore di default, mi aspetto il render dell'elemento correttamente",(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee2(){var children,dispatchSpy,wrapper,inputEl;return _regenerator["default"].wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:children=[{type:"Input",id:"a.b.c.surname",name:"surname"},{type:"Input",id:"a.name","default":"andrea"}];dispatchSpy=jest.spyOn(store,"dispatch");wrapper=(0,_react2.render)(_react["default"].createElement(_reactRedux.Provider,{store:store},_react["default"].createElement("div",null,_react["default"].createElement(_index["default"],{data:children,prefix:"app"}))));_context2.next=5;return wrapper.getByTestId("app.a.b.c.surname");case 5:inputEl=_context2.sent;_react2.fireEvent.change(inputEl,{target:{value:"Hello"}});expect(dispatchSpy.mock.lastCall[0].type).toEqual("@box/app/update");expect(store.getState()).toEqual({app:{a:{name:"andrea",b:{c:{surname:"Hello"}}}}});expect(wrapper.baseElement.innerHTML).toEqual("<div><div><input data-testid=\"app.a.b.c.surname\" name=\"surname\" value=\"Hello\"><input data-testid=\"app.a.name\" value=\"andrea\"></div></div>");case 10:case"end":return _context2.stop();}}},_callee2)})));it("Quando passo un valore ad un input obbligatorio, mi aspetto che sia validato (^isValid) 1",(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee3(){var children,dispatchSpy,wrapper,inputEl;return _regenerator["default"].wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:children=[{type:"Input",id:"surname",name:"surname",required:true},{type:"Text",text:"OKK",rules:{"^isValid":{eq:true}}}];dispatchSpy=jest.spyOn(store,"dispatch");wrapper=(0,_react2.render)(_react["default"].createElement(_reactRedux.Provider,{store:store},_react["default"].createElement("div",null,_react["default"].createElement(_index["default"],{data:children,prefix:"app"}))));_context3.next=5;return wrapper.getByTestId("app.surname");case 5:inputEl=_context3.sent;_react2.fireEvent.change(inputEl,{target:{value:"Hello"}});expect(dispatchSpy.mock.lastCall[0].type).toEqual("@box/app/update");expect(wrapper.baseElement.innerHTML).toEqual("<div><div><input data-testid=\"app.surname\" name=\"surname\" value=\"Hello\"><h1>OKK</h1></div></div>");case 9:case"end":return _context3.stop();}}},_callee3)})));it("Quando non passo un valore ad un input da validare con un validatore custom, mi aspetto che non sia valido (^isValid)",(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee4(){var children,wrapper,inputEl;return _regenerator["default"].wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:children=[{type:"CustomError",id:"surname"},{type:"Text",text:"OKK",rules:{"^isValid":{eq:true}}},{type:"Text",text:"KO!",rules:{"^isValid":{eq:false}}}];wrapper=(0,_react2.render)(_react["default"].createElement(_reactRedux.Provider,{store:store},_react["default"].createElement("div",null,_react["default"].createElement(_index["default"],{data:children,prefix:"app"}))));inputEl=wrapper.getByTestId("app.surname");expect(wrapper.baseElement.innerHTML).toEqual("<div><div><h1 data-testid=\"app.surname\">error1</h1><h1>KO!</h1></div></div>");case 4:case"end":return _context4.stop();}}},_callee4)})));it("Quando non passo un valore ad un input da validare, mi aspetto che non sia valido (^isValid)",(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee5(){var children,dispatchSpy,wrapper,inputEl;return _regenerator["default"].wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:children=[{type:"Input",id:"surname",name:"surname",validate:{self:{eq:"and"}}},{type:"Text",text:"OKK",rules:{"^isValid":{eq:true}}},{type:"Text",text:"KO!",rules:{"^isValid":{eq:false}}}];dispatchSpy=jest.spyOn(store,"dispatch");wrapper=(0,_react2.render)(_react["default"].createElement(_reactRedux.Provider,{store:store},_react["default"].createElement("div",null,_react["default"].createElement(_index["default"],{data:children,prefix:"app"}))));inputEl=wrapper.getByTestId("app.surname");_react2.fireEvent.change(inputEl,{target:{value:"a"}});expect(dispatchSpy.mock.lastCall[0].type).toEqual("@box/app/update");expect(wrapper.baseElement.innerHTML).toEqual("<div><div><input data-testid=\"app.surname\" name=\"surname\" value=\"a\"><h1>KO!</h1></div></div>");case 7:case"end":return _context5.stop();}}},_callee5)})))});